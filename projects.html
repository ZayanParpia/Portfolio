<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Projects - Zayan Parpia</title>
    <meta name="description" content="Cybersecurity and Cloud Projects by Zayan Parpia.">
    <meta name="keywords" content="cloud security, cybersecurity, projects, aws, backup system">
    <meta name="author" content="Zayan Parpia">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <style>
        /* Specific styles for the projects page */
        .project-category {
            margin-bottom: var(--spacing-xl);
        }

        .category-title {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-md);
            color: var(--color-accent);
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: var(--spacing-sm);
            display: inline-block;
        }

        .detailed-project {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .project-content-wrapper {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            max-height: 10000px;
            overflow: hidden;
            transition: max-height 0.8s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
            opacity: 1;
            padding: var(--spacing-md);
            padding-top: 0;
        }

        .project-card.collapsed .project-content-wrapper {
            max-height: 0;
            opacity: 0;
            padding: 0;
        }

        @media (min-width: 900px) {
            .project-content-wrapper {
                flex-direction: row;
                align-items: start;
            }

            .detailed-project .project-visuals {
                width: 50%;
                display: flex;
                flex-direction: column;
                gap: var(--spacing-md);
            }

            .detailed-project .project-info {
                width: 50%;
            }
        }

        .project-date {
            font-size: var(--font-size-sm);
            color: var(--color-text-gray);
            margin-top: -0.5rem;
            margin-bottom: var(--spacing-sm);
            font-style: italic;
        }

        .btn-read-more {
            background: transparent;
            color: var(--color-secondary);
            /* Blue */
            border: 2px solid var(--color-secondary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: all var(--transition-fast);
            margin-top: var(--spacing-sm);
        }

        .btn-read-more:hover {
            background: var(--color-secondary);
            color: white;
            box-shadow: 0 0 15px var(--color-secondary);
        }

        .main-image {
            width: 100%;
            height: auto;
            max-width: 100%;
            max-height: 65vh;
            border-radius: var(--radius-md);
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }


        .proof-code {
            font-family: monospace;
            font-size: 0.8em;
            background: rgba(0, 0, 0, 0.3);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            color: var(--color-secondary);
            display: block;
            margin-top: 0.25rem;
        }
    </style>
</head>

<body>

    <!-- ===== NAVIGATION BAR ===== -->
    <nav class="navbar" id="navbar">
        <div class="container">
            <a href="index.html" class="logo">Portfolio</a>

            <!-- Mobile Menu Toggle -->
            <div class="menu-toggle" id="menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <!-- Navigation Links -->
            <ul class="nav-links" id="nav-links">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="projects.html" class="nav-link active">Projects</a></li>
                <li><a href="index.html#skills" class="nav-link">Skills</a></li>
            </ul>
        </div>
    </nav>

    <!-- ===== HEADER ===== -->
    <section class="section" style="padding-top: 120px; padding-bottom: 40px;">
        <div class="container">
            <h1 class="section-title fade-in">My Projects</h1>
        </div>
    </section>

    <!-- ===== PROJECTS LIST ===== -->
    <section class="section" style="padding-top: 0;">
        <div class="container">

            <!-- CLOUD PROJECTS -->
            <div class="project-category fade-in">
                <h2 class="category-title">Cloud Projects</h2>
                <div class="projects-grid">

                    <!-- CLOUD VM SUBNETTING PLAYGROUND -->
                    <div class="project-card detailed-project collapsed" style="margin-bottom: var(--spacing-lg);">
                        <div class="project-header-top">
                            <div class="project-title-group">
                                <h3 style="margin: 0;">Cloud VM Subnetting Playground</h3>
                                <p class="project-date" style="margin: 0; font-size: 0.85rem; opacity: 0.7;">January 6,
                                    2026</p>
                            </div>
                            <button class="collapse-btn" onclick="toggleProject(this)" title="Collapse Project">
                                <svg class="collapse-chevron" viewBox="0 0 24 24" width="24" height="24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
                        <div class="project-content-wrapper">
                            <div class="project-visuals">
                                <div class="screenshot-item">
                                    <div class="screenshot-meta">
                                        <h4>Network Topology</h4>
                                        <p>High-level design showing the custom VPC with public and private subnets
                                            hosting Ubuntu EC2 instances.</p>
                                    </div>
                                    <img src="Subnet-Project/Subnet Diagram.png" alt="VPC Network Diagram"
                                        class="main-image zoom-img">
                                </div>

                                <!-- Vertical Screenshot List -->
                                <div class="screenshot-list">
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>Subnet Configuration</h4>
                                            <p>Overview of the public and private subnets acting as the foundation for
                                                the VPC network architecture.</p>
                                        </div>
                                        <img src="Subnet-Project/Screenshots/subnet.png" alt="Subnet Configuration"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>Instance A Config</h4>
                                            <p>Configuration of the first Ubuntu instance deployed in the public subnet
                                                with an Elastic IP for access.</p>
                                        </div>
                                        <img src="Subnet-Project/Screenshots/VMA.png" alt="EC2 Instance A"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>Security Group A</h4>
                                            <p>Inbound rules for Instance A allowing SSH (Port 22) only from my specific
                                                IP address to enforce least privilege.</p>
                                        </div>
                                        <img src="Subnet-Project/Screenshots/VMA ACL.png" alt="Security Group Rules A"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>Instance B Config</h4>
                                            <p>Setup of the second Ubuntu instance in the private subnet, accessible
                                                only via internal routing.</p>
                                        </div>
                                        <img src="Subnet-Project/Screenshots/VmB.png" alt="EC2 Instance B"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>Security Group B</h4>
                                            <p>Strict security group settings for Instance B, limiting internal traffic
                                                flow and blocking public ingress.</p>
                                        </div>
                                        <img src="Subnet-Project/Screenshots/VMB ACL.png" alt="Security Group Rules B"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>VPC Flow Logs</h4>
                                            <p>CloudWatch Log stream capturing encrypted metadata of network traffic for
                                                monitoring and auditing.</p>
                                        </div>
                                        <img src="Subnet-Project/Screenshots/FLowLog.png" alt="VPC Flow Logs"
                                            class="screenshot-img zoom-img">
                                    </div>
                                </div>
                            </div>
                            <div class="project-info">
                                <h3>Cloud VM Subnetting Playground</h3>
                                <p class="project-date">January 6, 2026</p>
                                <div class="project-tags">
                                    <span class="tag">AWS VPC</span>
                                    <span class="tag">Subnets</span>
                                    <span class="tag">EC2</span>
                                    <span class="tag">CloudWatch</span>
                                    <span class="tag">KMS</span>
                                </div>
                                <p>A hands-on environment building a secure AWS network infrastructure to master
                                    subnets, routing, and access controls.</p>

                                <button class="btn-read-more" onclick="toggleDetails(this)">Read More</button>

                                <div class="project-details" style="display: none; margin-top: var(--spacing-sm);">
                                    <p style="margin-bottom: var(--spacing-sm);">
                                        This project was a deep dive into AWS networking fundamentals. I built a custom
                                        VPC from scratch, creating a realistic environment to understand how traffic
                                        flows between public and private subnets.
                                        I launched two Ubuntu EC2 instances in the same subnet and configured their
                                        Security Groups to allow specific traffic from eachother only, verifying connectivity through ping
                                        and traceroute commands.
                                        A key component was security and monitoring: I enabled VPC Flow Logs to capture
                                        traffic data, storing these logs in CloudWatch encrypted with a custom KMS key.
                                        This allowed me to visualize accepted and rejected traffic events, directly
                                        observing the impact of my security group rules.
                                    </p>
                                </div>


                                <div class="project-doc-container" style="margin-top: var(--spacing-md);">
                                    <button class="doc-toggle-btn"
                                        style="border-color: var(--color-secondary); color: var(--color-secondary);"
                                        onclick="toggleDocumentation(this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="width:16px; height:16px; transition: transform 0.3s;"
                                            class="chevron">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        View Project Documentation
                                    </button>
                                    <div class="doc-content-wrapper">
                                        <div class="artifact-grid">
                                            <div class="artifact-box">
                                                <h4>Logs</h4>
                                                <div class="artifact-content">2025-12-22
                                                    2025-12-26
                                                    2025-12-27
                                                    2025-12-30
                                                    2026-01-01
                                                    2026-01-04
                                                    2026-01-06</div>
                                            </div>
                                            <div class="artifact-box">
                                                <h4>Progress/Outline</h4>
                                                <div class="artifact-content">Project goal: Build a small, realistic AWS
                                                    network to learn how subnets, routing, ARP, security groups, and
                                                    flow logs work, and to practice cloud security basics.

                                                    What I built (short):
                                                    Two Ubuntu EC2 instances running in the same VPC but placed in
                                                    different subnets, configured security groups, observed ARP and
                                                    routing behavior, tested connectivity (ping/traceroute), and sent
                                                    VPC Flow Logs to CloudWatch encrypted with a KMS key.

                                                    Environment & tools

                                                    AWS: VPC, Subnets, EC2 (Ubuntu), Network Interfaces (ENIs), Elastic
                                                    IPs

                                                    CloudWatch Logs (Flow Logs) + KMS for encryption

                                                    Linux commands used: ip a, ip route, ip neigh, ping, traceroute,
                                                    tcpdump

                                                    SSH / SCP from my laptop for access and file transfer

                                                    Key steps completed

                                                    Designed one VPC and two subnets (172.31.0.0/20 range).

                                                    Launched two Ubuntu EC2 instances in different subnets and verified
                                                    private IPs.

                                                    Configured security groups to allow SSH and ICMP only from intended
                                                    sources.

                                                    Assigned Elastic IPs for public SSH access when needed.

                                                    Tested connectivity: ping, traceroute, and verified ARP entries
                                                    appear after traffic.

                                                    Created a CloudWatch Log Group and enabled VPC Flow Logs for the
                                                    subnet.

                                                    Created a KMS key and attached a safe key policy; configured Flow
                                                    Logs to use that KMS key so logs are encrypted at rest.

                                                    Verified logs arrive in CloudWatch and filtered for ICMP (protocol
                                                    1) to see ping records.</div>
                                            </div>
                                        </div>
                                    </div>

                                    <ul class="feature-list" style="margin-top: var(--spacing-md);">
                                        <li class="feature-item">
                                            <div class="feature-icon">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path
                                                        d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                    </path>
                                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                                </svg>
                                            </div>
                                            <div class="feature-content">
                                                <h4>VPC Architecture</h4>
                                                <p>Custom VPC design with granular subnet allocation for isolated
                                                    workloads.
                                                </p>
                                            </div>
                                        </li>
                                        <li class="feature-item">
                                            <div class="feature-icon">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                                </svg>
                                            </div>
                                            <div class="feature-content">
                                                <h4>Security Groups</h4>
                                                <p>Stateful filtering with least-privilege rules (SSH from specific IP,
                                                    limited ICMP).</p>
                                            </div>
                                        </li>
                                        <li class="feature-item">
                                            <div class="feature-icon">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                                </svg>
                                            </div>
                                            <div class="feature-content">
                                                <h4>VPC Flow Logs</h4>
                                                <p>Enabled comprehensive traffic monitoring for auditing and
                                                    troubleshooting.</p>
                                            </div>
                                        </li>
                                        <li class="feature-item">
                                            <div class="feature-icon">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="3"></circle>
                                                    <path d="M12 12v10"></path>
                                                    <path d="M15 15h3"></path>
                                                    <path d="M15 19h3"></path>
                                                </svg>
                                            </div>
                                            <div class="feature-content">
                                                <h4>KMS Encryption</h4>
                                                <p>Encrypted CloudWatch Log Groups using customer-managed keys (CMKs).
                                                </p>
                                            </div>
                                        </li>
                                    </ul>

                                    <div class="security-practices" style="margin-top: var(--spacing-md);">
                                        <button class="doc-toggle-btn btn-secondary"
                                            onclick="toggleSecurityPractices(this)">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                style="width:20px; height:20px; transition: transform 0.3s;"
                                                id="sec-chevron">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                            Security Practices
                                        </button>
                                        <div class="sec-content-wrapper" id="sec-content">
                                            <p style="margin-top: var(--spacing-sm);">
                                                Implemented least-privilege Security Groups allowing strictly SSH and
                                                ICMP. Enabled VPC Flow Logs for full traffic visibility. Used AWS KMS to
                                                encrypt sensitive log data at rest, ensuring compliance and data
                                                security.
                                            </p>
                                        </div>
                                    </div>

                                    <div class="what-i-learned">
                                        <button class="doc-toggle-btn btn-secondary" onclick="toggleWhatILearned(this)">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                style="width:20px; height:20px; transition: transform 0.3s;"
                                                id="learn-chevron">
                                                <polyline points="6 9 12 15 18 9"></polyline>
                                            </svg>
                                            What I Learned
                                        </button>
                                        <div class="learn-content-wrapper" id="learn-content">
                                            <div style="margin-top: var(--spacing-sm);">
                                                <ul
                                                    style="list-style: disc; margin-left: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                                    <li><strong>Networking Fundamentals:</strong> Deepened understanding
                                                        of how private IPs, public IPs, subnets, and CIDR blocks
                                                        interact within a VPC.</li>
                                                    <li><strong>Routing & Connectivity:</strong> Learned how route
                                                        tables control traffic and how ARP works for local reachability.
                                                    </li>
                                                    <li><strong>Visibility is Key:</strong> Discovered the value of VPC
                                                        Flow Logs for troubleshooting connectivity issues and verifying
                                                        dropped traffic.</li>
                                                    <li><strong>Secure Encryption:</strong> Practiced creating and
                                                        managing KMS keys to secure service logs.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AUTOMATIC BACKUP SYSTEM -->
                    <div class="project-card detailed-project collapsed">
                        <div class="project-header-top">
                            <div class="project-title-group">
                                <h3 style="margin: 0;">Automatic Backup System</h3>
                                <p class="project-date" style="margin: 0; font-size: 0.85rem; opacity: 0.7;">December
                                    26, 2025</p>
                            </div>
                            <button class="collapse-btn" onclick="toggleProject(this)" title="Collapse Project">
                                <svg class="collapse-chevron" viewBox="0 0 24 24" width="24" height="24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
                        <div class="project-content-wrapper">
                            <div class="project-visuals">
                                <div class="screenshot-item">
                                    <div class="screenshot-meta">
                                        <h4>Diagram</h4>
                                    </div>
                                    <img src="AWS-BACKUP/Diagram.png" alt="Automatic Backup System Diagram"
                                        class="main-image zoom-img">
                                </div>

                                <!-- Vertical Screenshot List -->
                                <div class="screenshot-list">
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>IAM Role</h4>
                                            <p>The "Backup" IAM role is configured with least-privilege permissions,
                                                allowing access only to specific S3 buckets and KMS keys.</p>
                                        </div>
                                        <img src="AWS-BACKUP/Screenshots/IAM.png" alt="IAM Role Configuration"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>KMS Encryption</h4>
                                            <p>A Customer Managed Key (CMK) is used to enforce server-side encryption
                                                for all backup objects stored in S3.</p>
                                        </div>
                                        <img src="AWS-BACKUP/Screenshots/KMS.png" alt="KMS Encryption Key"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>S3 Security</h4>
                                            <p>Block Public Access settings are enabled on the S3 bucket to prevent any
                                                unauthorized external access to the backup data.</p>
                                        </div>
                                        <img src="AWS-BACKUP/Screenshots/No Public S3.png" alt="S3 Public Access Block"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>S3 Storage</h4>
                                            <p>The S3 bucket structure organizes backups by drive and date, utilizing
                                                the Deep Glacier storage class for cost efficiency.</p>
                                        </div>
                                        <img src="AWS-BACKUP/Screenshots/S3.png" alt="S3 Bucket Structure"
                                            class="screenshot-img zoom-img">
                                    </div>
                                    <div class="screenshot-item">
                                        <div class="screenshot-meta">
                                            <h4>Email Notification</h4>
                                            <p>An automated SNS email report is sent upon completion, detailing the
                                                backup duration, size, and estimated storage costs.</p>
                                        </div>
                                        <img src="AWS-BACKUP/Screenshots/Email.png" alt="Backup Status Email"
                                            class="screenshot-img zoom-img">
                                    </div>
                                </div>
                            </div>
                            <div class="project-info">
                                <h3>Automatic Backup System</h3>
                                <p class="project-date">December 26, 2025</p>
                                <div class="project-tags">
                                    <span class="tag">AWS S3</span>
                                    <span class="tag">Python</span>
                                    <span class="tag">AWS KMS</span>
                                    <span class="tag">AWS SNS</span>
                                    <span class="tag">IAM</span>
                                </div>
                                <p>A robust, secure, and cost-effective automated backup solution leveraging AWS
                                    services.
                                </p>

                                <button class="btn-read-more" onclick="toggleDetails(this)">Read More</button>

                                <div class="project-details" style="display: none; margin-top: var(--spacing-sm);">
                                    <p style="margin-bottom: var(--spacing-sm);">
                                        This project demonstrates the use of AWS services to create a secure and
                                        cost-effective backup system. In this project,
                                        I used AWS S3 to store backups, AWS KMS for encryption, AWS SNS for email
                                        notifications, and IAM for least-privilege access controls.
                                        Every Friday at 10:00 Pm EST, the system will automatically backup all files in
                                        the
                                        specified directory(s) to an encrypted S3 bucket.
                                        All the files are put into a Deep Glacier storage class for cost optimization.
                                        To prevent the same files from being backed up multiple times, the script checks
                                        a
                                        list
                                        of hashes for each file and compares them to the hashes of the files in the S3
                                        bucket.
                                        If a file's hash matches a file in the S3 bucket, the script will skip it,
                                        backing
                                        up only files that are new
                                        or have been modified since the last backup. This saves time and storage space.
                                        When the backup is complete, the script will send an email notification to the
                                        specified email address using
                                        AWS SNS service. The Email contains the folders that were backed up, the time of
                                        the
                                        backup, and the size of the backup and other relevant information.

                                    </p>
                                </div>


                                <div class="project-script"
                                    style="margin-top: var(--spacing-md); background: #1e1e1e; padding: var(--spacing-sm); border-radius: var(--radius-sm); border: 1px solid var(--glass-border);">
                                    <div class="project-header-actions">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg"
                                                alt="Python" style="width: 24px; height: 24px;">
                                            <h4 style="color: #fff; margin: 0; font-family: 'Inter', sans-serif;">
                                                Python Script</h4>
                                        </div>
                                        <button class="copy-btn" onclick="copyCode(this)">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1">
                                                </path>
                                            </svg>
                                            Copy Code
                                        </button>
                                    </div>
                                    <pre
                                        style="max-height: 400px; overflow-y: auto; color: #d4d4d4; font-family: monospace; font-size: 0.85em; tab-size: 4; white-space: pre-wrap; word-break: break-all;"><code class="language-python">#!/usr/bin/env python3
&quot;&quot;&quot;
backups3_scheduled_mode_masked.py
- Same backup logic as original but with data-masking for PII before any output, logs, or manifest that may be uploaded to a portfolio.
- Sensitive configuration is read from environment variables (no hard-coded ARNs, bucket names, or absolute user paths).
- When writing user-facing output (logs, manifests, SNS body), values are masked.

USAGE: set S3_BUCKET, KMS_KEY_ARN, SNS_TOPIC_ARN, and SOURCE_DRIVES_JSON in the environment before running.
If not set, placeholders are used and the script will run in dry-run safely.
&quot;&quot;&quot;

import os
import json
import hashlib
import argparse
import boto3
import time
import sys
import signal
import re
from datetime import datetime, timezone

# -----------------------------
# Helpers for masking
# -----------------------------

def mask_partial(val, keep_start=3, keep_end=4):
    if not val:
        return &quot;&lt;REDACTED&gt;&quot;
    if len(val) &lt;= keep_start + keep_end:
        return &quot;*&quot; * len(val)
    return val[:keep_start] + &quot;...&quot; + val[-keep_end:]


def mask_arn(arn):
    if not arn or not isinstance(arn, str):
        return &quot;&lt;REDACTED_ARN&gt;&quot;
    parts = arn.split(&quot;:&quot;)
    if len(parts) &lt; 6:
        return mask_partial(arn)
    service = parts[2]
    resource = parts[5] if len(parts) &gt; 5 else parts[-1]
    return f&quot;arn:aws:{service}:&lt;REDACTED_REGION&gt;:&lt;REDACTED_ACCOUNT&gt;:{mask_partial(resource)}&quot;


def mask_bucket(bucket):
    if not bucket:
        return &quot;&lt;REDACTED_BUCKET&gt;&quot;
    return mask_partial(bucket, keep_start=2, keep_end=2)


def mask_s3_key(key):
    # show the prefix but redact the filename
    if not key:
        return &quot;&lt;REDACTED_S3_KEY&gt;&quot;
    parts = key.split(&quot;/&quot;)
    if len(parts) &lt;= 2:
        return &quot;.../&quot; + mask_partial(parts[-1])
    return &quot;/&quot;.join(parts[:-1]) + &quot;/&quot; + mask_partial(parts[-1])


def mask_path_for_output(path):
    if not path:
        return &quot;&lt;REDACTED_PATH&gt;&quot;
    try:
        p = os.path.normpath(path)
        # redact user home
        home = os.path.normcase(os.path.expanduser(&quot;~&quot;))
        pnorm = os.path.normcase(p)
        if home and pnorm.startswith(home):
            rel = p[len(home):].lstrip(os.sep)
            return os.path.join(&quot;&lt;REDACTED_HOME&gt;&quot;, mask_partial(rel.replace(os.sep, &quot;/&quot;), 0, 10))
        # redact usernames in Windows style e.g. C:\Users\username\
        m = re.search(r&quot;(C:|D:|E:|F:)?\\Users\\([^\\/]+)(.*)&quot;, p, re.IGNORECASE)
        if m:
            drive = m.group(1) or &quot;&quot;
            rest = m.group(3) or &quot;&quot;
            return f&quot;{drive}\\Users\\&lt;REDACTED_USER&gt;\\{mask_partial(rest.replace('\\\\','/'), 0, 10)}&quot;
        # default: show only last path components
        parts = p.split(os.sep)
        if len(parts) &lt;= 3:
            return mask_partial(p)
        return os.sep.join(parts[:2]) + os.sep + &quot;...&quot; + os.sep + mask_partial(parts[-1])
    except Exception:
        return &quot;&lt;REDACTED_PATH&gt;&quot;


# -----------------------------
# Configuration (from env; masked in outputs)
# -----------------------------
S3_BUCKET = os.environ.get(&quot;S3_BUCKET&quot;) or &quot;&lt;REDACTED_BUCKET&gt;&quot;
KMS_KEY_ARN = os.environ.get(&quot;KMS_KEY_ARN&quot;) or &quot;&lt;REDACTED_KMS_ARN&gt;&quot;
SNS_TOPIC_ARN = os.environ.get(&quot;SNS_TOPIC_ARN&quot;) or None
AWS_REGION = os.environ.get(&quot;AWS_REGION&quot;, &quot;us-east-1&quot;)

# SOURCE_DRIVES_JSON example: '{&quot;C:\\\\&quot;: &quot;MAIN&quot;, &quot;E:\\\\&quot;: &quot;Black Hard Drive&quot;}'
SOURCE_DRIVES = {}
try:
    sdj = os.environ.get(&quot;SOURCE_DRIVES_JSON&quot;)
    if sdj:
        SOURCE_DRIVES = json.loads(sdj)
except Exception:
    SOURCE_DRIVES = {}

# fallbacks (non-sensitive placeholders) â€” kept minimal to avoid exposing user filesystem
if not SOURCE_DRIVES:
    SOURCE_DRIVES = {
        &quot;C:\\&quot;: &quot;MAIN&quot;
    }

# Local state files
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
HASH_DB_FILE = os.path.join(BASE_DIR, &quot;backup_hashes.json&quot;)
LOG_FILE = os.path.join(BASE_DIR, &quot;backup_log.txt&quot;)

# AWS clients (created with region; credentials come from environment/profile/role)
s3 = boto3.client(&quot;s3&quot;, region_name=AWS_REGION)
sns = boto3.client(&quot;sns&quot;, region_name=AWS_REGION)

CHUNK_SIZE = 64 * 1024  # 64KB
PRICE_PER_GB_DEEP_ARCHIVE = 0.00099  # USD per GB-month
PREWARN_SECONDS = 5 * 60
_interrupted = False


# -----------------------------
# Logging helper that masks sensitive fragments automatically
# -----------------------------

def safe_log(msg):
    # mask common configurable sensitive values before printing
    try:
        masked = msg.replace(S3_BUCKET, mask_bucket(S3_BUCKET) if S3_BUCKET else &quot;&lt;REDACTED_BUCKET&gt;&quot;)
        masked = masked.replace(KMS_KEY_ARN, mask_arn(KMS_KEY_ARN) if KMS_KEY_ARN else &quot;&lt;REDACTED_KMS_ARN&gt;&quot;)
        masked = masked.replace(SNS_TOPIC_ARN or &quot;&quot;, &quot;&lt;REDACTED_SNS&gt;&quot;)
    except Exception:
        masked = msg
    ts = datetime.now(timezone.utc).astimezone().isoformat()
    line = f&quot;{ts} {masked}&quot;
    print(line)
    try:
        with open(LOG_FILE, &quot;a&quot;, encoding=&quot;utf-8&quot;) as fh:
            fh.write(line + &quot;\n&quot;)
    except Exception:
        pass


# -----------------------------
# Minimal helpers (hashing, size)
# -----------------------------

def compute_sha256(path):
    h = hashlib.sha256()
    with open(path, &quot;rb&quot;) as f:
        for chunk in iter(lambda: f.read(CHUNK_SIZE), b&quot;&quot;):
            h.update(chunk)
    return h.hexdigest()


def load_hash_db():
    if os.path.exists(HASH_DB_FILE):
        try:
            with open(HASH_DB_FILE, &quot;r&quot;, encoding=&quot;utf-8&quot;) as fh:
                return json.load(fh)
        except Exception:
            return {}
    return {}


def save_hash_db_atomic(db):
    tmp = HASH_DB_FILE + &quot;.tmp&quot;
    with open(tmp, &quot;w&quot;, encoding=&quot;utf-8&quot;) as fh:
        json.dump(db, fh, indent=2)
    os.replace(tmp, HASH_DB_FILE)


def human_readable_size(bytes_count):
    for unit in [&quot;B&quot;, &quot;KB&quot;, &quot;MB&quot;, &quot;GB&quot;, &quot;TB&quot;]:
        if bytes_count &lt; 1024 or unit == &quot;TB&quot;:
            return f&quot;{bytes_count:.2f} {unit}&quot;
        bytes_count /= 1024.0
    return f&quot;{bytes_count:.2f} TB&quot;


# -----------------------------
# Path helpers (keeps original behavior but avoids exposing raw paths in output)
# -----------------------------

def path_is_excluded(full_path, exclude_parts):
    p = os.path.normcase(os.path.abspath(full_path))
    for part in exclude_parts:
        if part.lower() in p.lower():
            return True
    return False


def build_allowed_paths_for_source(source_root, allowed_folder_names, explicit_paths):
    allowed = []
    for p in explicit_paths:
        try:
            if os.path.normcase(os.path.abspath(p)).startswith(os.path.normcase(source_root)):
                allowed.append(os.path.abspath(p))
        except Exception:
            pass

    users_path = os.path.join(source_root, &quot;Users&quot;)
    if os.path.exists(users_path):
        try:
            for username in os.listdir(users_path):
                user_base = os.path.join(users_path, username)
                for name in allowed_folder_names:
                    candidate = os.path.join(user_base, name)
                    if os.path.exists(candidate):
                        allowed.append(candidate)
        except Exception:
            pass

    for name in allowed_folder_names:
        candidate = os.path.join(source_root, name)
        if os.path.exists(candidate):
            allowed.append(candidate)

    normalized = []
    for p in allowed:
        try:
            normalized.append(os.path.normpath(os.path.abspath(p)))
        except Exception:
            pass
    return sorted(set(normalized))


# -----------------------------
# Signals
# -----------------------------

def _signal_handler(signum, frame):
    global _interrupted
    _interrupted = True
    safe_log(f&quot;Received signal {signum}; marking interrupted.&quot;)


signal.signal(signal.SIGINT, _signal_handler)
try:
    signal.signal(signal.SIGTERM, _signal_handler)
except Exception:
    pass


# -----------------------------
# Backup logic (keeps most behaviour, but uses masking in all outputs)
# -----------------------------
ALLOWED_FOLDER_NAMES = [&quot;Pictures&quot;, &quot;Videos&quot;, &quot;Desktop&quot;, &quot;Downloads&quot;]
EXPLICIT_ABSOLUTE_PATHS = []  # encourage supplying via SOURCE_DRIVES_JSON rather than hard-coding
EXCLUDE_PATH_PARTS = [
    r&quot;\\Windows&quot;,
    r&quot;\\Program Files&quot;,
    r&quot;\\Program Files (x86)&quot;,
    r&quot;\\System Volume Information&quot;,
    r&quot;\\$Recycle.Bin&quot;,
    r&quot;\\hiberfil.sys&quot;,
    r&quot;\\pagefile.sys&quot;,
    r&quot;\\SwapFile.sys&quot;,
    r&quot;\\Recovery&quot;,
    r&quot;\\PerfLogs&quot;
]


def gather_candidate_files():
    candidates = []
    drive_present = {}
    for source, drive_name in SOURCE_DRIVES.items():
        present = os.path.exists(source)
        drive_present[drive_name] = present
        if not present:
            safe_log(f&quot;Drive root missing for pre-scan: {mask_path_for_output(source)}&quot;)
            continue

        allowed_roots = build_allowed_paths_for_source(source, ALLOWED_FOLDER_NAMES, EXPLICIT_ABSOLUTE_PATHS)
        if not allowed_roots:
            safe_log(f&quot;No allowed roots found under {mask_path_for_output(source)}&quot;)
            continue

        for root_allowed in allowed_roots:
            for root, dirs, files in os.walk(root_allowed):
                dirs[:] = [d for d in dirs if not path_is_excluded(os.path.join(root, d), EXCLUDE_PATH_PARTS)]
                for fname in files:
                    file_path = os.path.join(root, fname)
                    if path_is_excluded(file_path, EXCLUDE_PATH_PARTS):
                        continue
                    candidates.append((os.path.normcase(os.path.abspath(file_path)), drive_name))
    return candidates, drive_present


def backup_run(dry_run=False):
    start_time = time.time()
    start_dt_utc = datetime.utcnow().replace(tzinfo=timezone.utc).isoformat()

    persisted_hashes = load_hash_db()
    updated_hashes = dict(persisted_hashes)

    uploaded_keys = []
    duplicate_skips = []
    errors = []
    run_manifest = {
        &quot;run_start_utc&quot;: start_dt_utc,
        &quot;dry_run&quot;: bool(dry_run),
        &quot;uploaded&quot;: [],
        &quot;skipped_duplicates&quot;: [],
        &quot;errors&quot;: [],
        &quot;estimates&quot;: {},
    }

    safe_log(&quot;Starting pre-scan for estimation...&quot;)
    candidates, drive_present = gather_candidate_files()
    candidates = list(dict.fromkeys(candidates))
    total_files = len(candidates)
    total_bytes = 0
    drive_totals = {v: 0 for v in SOURCE_DRIVES.values()}
    drive_uploaded = {v: 0 for v in SOURCE_DRIVES.values()}

    for path, dn in candidates:
        drive_totals.setdefault(dn, 0)
        drive_totals[dn] += 1
        try:
            total_bytes += os.path.getsize(path)
        except Exception:
            pass

    run_manifest[&quot;estimates&quot;][&quot;total_files&quot;] = total_files
    run_manifest[&quot;estimates&quot;][&quot;total_bytes&quot;] = total_bytes
    safe_log(f&quot;Pre-scan: {total_files} files, {human_readable_size(total_bytes)} total across drives&quot;)

    content_hash_to_s3key = {}
    processed_files = 0
    processed_bytes = 0
    seen_paths = set()

    for idx, (abs_path, drive_name) in enumerate(candidates, start=1):
        if _interrupted:
            safe_log(&quot;Interrupted flag set; stopping processing loop.&quot;)
            break

        if abs_path in seen_paths:
            continue
        seen_paths.add(abs_path)
        processed_files += 1
        try:
            file_size = os.path.getsize(abs_path)
        except Exception:
            file_size = 0

        matched_source = None
        for src in SOURCE_DRIVES.keys():
            try:
                if os.path.normcase(os.path.abspath(abs_path)).startswith(os.path.normcase(os.path.abspath(src))):
                    matched_source = src
                    break
            except Exception:
                pass
        if matched_source:
            try:
                relpath = os.path.relpath(abs_path, matched_source)
            except Exception:
                relpath = os.path.basename(abs_path)
        else:
            relpath = os.path.basename(abs_path)

        today_prefix = datetime.utcnow().strftime(&quot;%Y/%m/%d&quot;)
        s3_key = f&quot;{today_prefix}/{drive_name}/{relpath}&quot;.replace(&quot;\\&quot;, &quot;/&quot;)

        try:
            file_hash = compute_sha256(abs_path)
        except Exception as e:
            safe_log(f&quot;ERROR hashing {mask_path_for_output(abs_path)}: {str(e)}&quot;)
            errors.append({&quot;path&quot;: mask_path_for_output(abs_path), &quot;error&quot;: str(e)})
            run_manifest[&quot;errors&quot;].append({&quot;path&quot;: mask_path_for_output(abs_path), &quot;error&quot;: str(e)})
            continue

        if file_hash in content_hash_to_s3key:
            existing_key = content_hash_to_s3key[file_hash]
            safe_log(f&quot;Duplicate content (this run), skipping upload: {mask_path_for_output(abs_path)} -&gt; matches {mask_s3_key(existing_key)}&quot;)
            duplicate_skips.append((mask_path_for_output(abs_path), mask_s3_key(existing_key)))
            run_manifest[&quot;skipped_duplicates&quot;].append({&quot;path&quot;: mask_path_for_output(abs_path), &quot;existing_s3_key&quot;: mask_s3_key(existing_key)})
            updated_hashes[abs_path] = file_hash
            continue

        if persisted_hashes.get(abs_path) == file_hash:
            safe_log(f&quot;Unchanged, skipping upload: {mask_path_for_output(abs_path)}&quot;)
            run_manifest.setdefault(&quot;unchanged&quot;, []).append(mask_path_for_output(abs_path))
            continue

        if dry_run:
            safe_log(f&quot;(dry) Would upload: {mask_path_for_output(abs_path)} -&gt; s3://{mask_bucket(S3_BUCKET)}/{mask_s3_key(s3_key)} (DEEP_ARCHIVE)&quot;)
            run_manifest[&quot;uploaded&quot;].append({
                &quot;path&quot;: mask_path_for_output(abs_path),
                &quot;s3_key&quot;: mask_s3_key(s3_key),
                &quot;size_bytes&quot;: file_size,
                &quot;hash&quot;: file_hash,
                &quot;action&quot;: &quot;dry_upload&quot;
            })
            content_hash_to_s3key[file_hash] = s3_key
            uploaded_keys.append(s3_key)
            updated_hashes[abs_path] = file_hash
            drive_uploaded.setdefault(drive_name, 0)
            drive_uploaded[drive_name] += 1
        else:
            try:
                s3.upload_file(
                    Filename=abs_path,
                    Bucket=S3_BUCKET,
                    Key=s3_key,
                    ExtraArgs={
                        &quot;ServerSideEncryption&quot;: &quot;aws:kms&quot;,
                        &quot;SSEKMSKeyId&quot;: KMS_KEY_ARN,
                        &quot;StorageClass&quot;: &quot;DEEP_ARCHIVE&quot;
                    }
                )
                safe_log(f&quot;Uploaded: {mask_path_for_output(abs_path)} -&gt; s3://{mask_bucket(S3_BUCKET)}/{mask_s3_key(s3_key)} (DEEP_ARCHIVE)&quot;)
                uploaded_keys.append(s3_key)
                content_hash_to_s3key[file_hash] = s3_key
                run_manifest[&quot;uploaded&quot;].append({
                    &quot;path&quot;: mask_path_for_output(abs_path),
                    &quot;s3_key&quot;: mask_s3_key(s3_key),
                    &quot;size_bytes&quot;: file_size,
                    &quot;hash&quot;: file_hash,
                    &quot;action&quot;: &quot;uploaded&quot;
                })
                updated_hashes[abs_path] = file_hash
                drive_uploaded.setdefault(drive_name, 0)
                drive_uploaded[drive_name] += 1
            except Exception as e:
                safe_log(f&quot;Failed upload {mask_path_for_output(abs_path)} -&gt; {mask_s3_key(s3_key)}: {str(e)}&quot;)
                errors.append({&quot;path&quot;: mask_path_for_output(abs_path), &quot;error&quot;: str(e)})
                run_manifest[&quot;errors&quot;].append({&quot;path&quot;: mask_path_for_output(abs_path), &quot;error&quot;: str(e)})

        processed_bytes += file_size

        elapsed = time.time() - start_time
        files_done = processed_files
        if files_done &gt; 0:
            est_total = (elapsed / files_done) * total_files if total_files else elapsed
            est_remaining = max(0.0, est_total - elapsed)
            safe_log(f&quot;Progress: {files_done}/{total_files} files. Elapsed {elapsed:.1f}s. Est remaining {est_remaining:.1f}s.&quot;)
            run_manifest.setdefault(&quot;progress_samples&quot;, []).append({
                &quot;time&quot;: datetime.utcnow().replace(tzinfo=timezone.utc).isoformat(),
                &quot;processed_files&quot;: files_done,
                &quot;elapsed_seconds&quot;: elapsed,
                &quot;estimated_total_seconds&quot;: est_total,
                &quot;estimated_remaining_seconds&quot;: est_remaining
            })

    # finish
    end_time = time.time()
    duration = end_time - start_time

    run_manifest[&quot;run_end_utc&quot;] = datetime.utcnow().replace(tzinfo=timezone.utc).isoformat()
    run_manifest[&quot;duration_seconds&quot;] = duration
    run_manifest[&quot;files_uploaded_count&quot;] = len(uploaded_keys)
    run_manifest[&quot;files_processed_count&quot;] = processed_files
    run_manifest[&quot;bytes_processed&quot;] = processed_bytes
    run_manifest[&quot;interrupted&quot;] = bool(_interrupted)

    # Always attempt to save updated hash DB (even if interrupted)
    if not dry_run:
        try:
            save_hash_db_atomic(updated_hashes)
            safe_log(&quot;Saved updated hash DB (atomic).&quot;)
        except Exception as e:
            safe_log(f&quot;Failed saving hash DB: {str(e)}&quot;)
            run_manifest[&quot;errors&quot;].append({&quot;save_hash_db&quot;: str(e)})

    # compute bucket size for cost estimate (best-effort)
    readable_size = &quot;unknown&quot;
    estimated_cost = 0.0
    if not dry_run:
        try:
            total_bytes_bucket = 0
            paginator = s3.get_paginator(&quot;list_objects_v2&quot;)
            for page in paginator.paginate(Bucket=S3_BUCKET):
                for obj in page.get(&quot;Contents&quot;, []):
                    total_bytes_bucket += obj.get(&quot;Size&quot;, 0)
            readable_size = human_readable_size(total_bytes_bucket)
            total_gb = total_bytes_bucket / (1024 ** 3)
            estimated_cost = total_gb * PRICE_PER_GB_DEEP_ARCHIVE
            safe_log(f&quot;Bucket '{mask_bucket(S3_BUCKET)}' size: {readable_size} ({total_gb:.3f} GB)&quot;)
        except Exception as e:
            safe_log(f&quot;Could not compute bucket size: {str(e)}&quot;)

    # prepare drive status summary for reporting
    drive_report_lines = []
    for src, drive_name in SOURCE_DRIVES.items():
        present = os.path.exists(src)
        if not present:
            drive_report_lines.append(f&quot;{drive_name}: Offline&quot;)
            continue
        total = drive_totals.get(drive_name, 0)
        uploaded = drive_uploaded.get(drive_name, 0)
        pct = (uploaded / total * 100.0) if total else (100.0 if uploaded else 0.0)
        drive_report_lines.append(f&quot;{drive_name}: Online (Backed up {pct:.1f}%)&quot;)

    report = {
        &quot;uploaded_keys&quot;: [mask_s3_key(k) for k in uploaded_keys],
        &quot;duplicate_skips&quot;: duplicate_skips,
        &quot;errors&quot;: run_manifest.get(&quot;errors&quot;, []),
        &quot;manifest_file&quot;: None,
        &quot;duration_seconds&quot;: duration,
        &quot;estimated_monthly_cost_usd&quot;: estimated_cost,
        &quot;bucket_size_readable&quot;: readable_size,
        &quot;interrupted&quot;: bool(_interrupted),
        &quot;files_processed&quot;: processed_files,
        &quot;files_uploaded&quot;: len(uploaded_keys),
        &quot;drive_report_lines&quot;: drive_report_lines
    }

    safe_log(f&quot;Backup run complete. Uploaded: {len(uploaded_keys)} files. Interrupted: {report['interrupted']}. Duration: {duration:.1f}s&quot;)

    return report, run_manifest


# -----------------------------
# Main (masking outputs & use env-config)
# -----------------------------

def format_local_time_for_email(dt_utc=None):
    from zoneinfo import ZoneInfo
    try:
        TORONTO_TZ = ZoneInfo(&quot;America/Toronto&quot;)
    except Exception:
        TORONTO_TZ = None
    if dt_utc is None:
        dt = datetime.now(tz=TORONTO_TZ) if TORONTO_TZ else datetime.now()
    else:
        dt = dt_utc.astimezone(TORONTO_TZ) if TORONTO_TZ else dt_utc
    tzlabel = dt.strftime(&quot;%Z&quot;) if dt.strftime(&quot;%Z&quot;) else &quot;EST&quot;
    return dt.strftime(&quot;%Y-%m-%d %H:%M&quot;) + f&quot; {tzlabel}&quot;


if __name__ == &quot;__main__&quot;:
    parser = argparse.ArgumentParser(description=&quot;Backup changed files to S3 (YYYY/MM/DD/&lt;DRIVE_NAME&gt;/) - outputs masked for portfolio&quot;)
    parser.add_argument(&quot;--dry-run&quot;, action=&quot;store_true&quot;, help=&quot;Perform a dry run (no uploads).&quot;)
    parser.add_argument(&quot;--skip-prewarn&quot;, action=&quot;store_true&quot;, help=&quot;Skip the 5-minute pre-warning and start immediately.&quot;)
    args = parser.parse_args()

    if not args.skip_prewarn:
        safe_log(&quot;Pre-warn: backup will start in 5 minutes (skipped showing exact drive/bucket info in logs)&quot;)
        try:
            for _ in range(PREWARN_SECONDS):
                if _interrupted:
                    break
                time.sleep(1)
        except KeyboardInterrupt:
            _interrupted = True
            safe_log(&quot;Interrupted during pre-warn sleep.&quot;)
    else:
        safe_log(&quot;Skipping pre-warn; starting immediately.&quot;)

    try:
        if args.dry_run:
            safe_log(&quot;Starting DRY-RUN backup now (no uploads).&quot;)
            report, run_manifest = backup_run(dry_run=True)
        else:
            safe_log(&quot;Starting REAL backup now (uploads will occur).&quot;)
            report, run_manifest = backup_run(dry_run=False)
    except Exception as e:
        safe_log(f&quot;Unhandled exception during backup: {str(e)}&quot;)
        report = {
            &quot;uploaded_keys&quot;: [],
            &quot;duplicate_skips&quot;: [],
            &quot;errors&quot;: [{&quot;fatal&quot; : str(e)}],
            &quot;manifest_file&quot;: None,
            &quot;duration_seconds&quot;: 0.0,
            &quot;estimated_monthly_cost_usd&quot;: 0.0,
            &quot;bucket_size_readable&quot;: &quot;unknown&quot;,
            &quot;interrupted&quot;: True,
            &quot;files_processed&quot;: 0,
            &quot;files_uploaded&quot;: 0,
            &quot;drive_report_lines&quot;: [f&quot;{v}: Offline&quot; if not os.path.exists(k) else f&quot;{v}: Online (Backed up 0%)&quot; for k, v in SOURCE_DRIVES.items()]
        }
        run_manifest = {&quot;errors&quot;: [str(e)]}

    # Compose masked subject/body
    status = &quot;Completed&quot;
    if report.get(&quot;errors&quot;):
        status = &quot;Failed&quot;
    if report.get(&quot;interrupted&quot;):
        status = &quot;Interrupted&quot; if status != &quot;Failed&quot; else &quot;Failed (Interrupted)&quot;

    subj_time = format_local_time_for_email(datetime.utcnow().replace(tzinfo=timezone.utc))
    subject = f&quot;Backup {status} â€” {subj_time}&quot;

    lines = []
    lines.append(f&quot;Backup {status} â€” finished at {subj_time}&quot;)
    lines.append(&quot;&quot;)
    lines.append(&quot;Drive status:&quot;)
    for line in report.get(&quot;drive_report_lines&quot;, []):
        lines.append(f&quot; - {line}&quot;)
    lines.append(&quot;&quot;)
    lines.append(f&quot;Files processed: {report.get('files_processed', 0)}&quot;)
    lines.append(f&quot;Files uploaded this run: {report.get('files_uploaded', 0)}&quot;)
    lines.append(&quot;&quot;)
    lines.append(f&quot;Bucket total storage (estimate): {report.get('bucket_size_readable', 'unknown')}&quot;)
    lines.append(f&quot;Estimated monthly storage cost (Deep Archive): ${report.get('estimated_monthly_cost_usd', 0.0):.2f}&quot;)
    lines.append(f&quot;Backup duration: {report.get('duration_seconds', 0.0):.2f} seconds&quot;)
    lines.append(&quot;&quot;)
    if report.get(&quot;errors&quot;):
        lines.append(&quot;Errors / Notes:&quot;)
        for e in report.get(&quot;errors&quot;, []):
            if isinstance(e, dict):
                lines.append(f&quot; - {json.dumps(e)}&quot;)
            else:
                lines.append(f&quot; - {str(e)}&quot;)
        lines.append(&quot;&quot;)
    lines.append(f&quot;Manifest file: {mask_partial('backup_manifest_masked.json')}&quot;)
    lines.append(&quot;&quot;)
    lines.append(&quot;Notes:&quot;)
    lines.append(&quot; - Outputs mask bucket names, ARNs, and full local paths for privacy.&quot;)
    lines.append(&quot; - Retrieval from DEEP_ARCHIVE typically takes 12â€“48 hours.&quot;)

    body = &quot;\n&quot;.join(lines)

    # Publish SNS (masked content only)
    if SNS_TOPIC_ARN:
        try:
            sns.publish(TopicArn=SNS_TOPIC_ARN, Message=body, Subject=subject)
            safe_log(&quot;SNS notification sent (final masked report).&quot;)
        except Exception as e:
            safe_log(f&quot;SNS publish failed: {str(e)}&quot;)
    else:
        safe_log(&quot;SNS_TOPIC_ARN not set; skipping SNS publish.&quot;)

    # write a masked manifest for portfolio or review (never contain raw absolute paths / ARNs)
    try:
        masked_manifest_fn = os.path.join(BASE_DIR, f&quot;backup_manifest_masked_{datetime.utcnow().strftime('%Y%m%d_%H%M%S')}.json&quot;)
        with open(masked_manifest_fn, &quot;w&quot;, encoding=&quot;utf-8&quot;) as mf:
            json.dump({
                &quot;run&quot;: run_manifest,
                &quot;report&quot;: report,
                &quot;config_masks&quot;: {
                    &quot;s3_bucket&quot;: mask_bucket(S3_BUCKET),
                    &quot;kms&quot;: mask_arn(KMS_KEY_ARN),
                    &quot;sns&quot;: &quot;&lt;REDACTED_SNS&gt;&quot;
                }
            }, mf, indent=2)
        safe_log(f&quot;Wrote masked run manifest: {mask_path_for_output(masked_manifest_fn)}&quot;)
    except Exception as e:
        safe_log(f&quot;Failed to write masked manifest file: {str(e)}&quot;)

    safe_log(&quot;Script exiting. (Outputs have been masked for privacy.)&quot;)
    # exit code: 0 if completed without interruption and no errors; 2 otherwise
    if report.get("interrupted") or report.get("errors"):
        sys.exit(2)
    sys.exit(0)
</code></pre>

                                </div>

                                <div class="doc-container">
                                    <button class="doc-toggle-btn btn-secondary" onclick="toggleDocumentation(this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="width:20px; height:20px; transition: transform 0.3s;"
                                            id="doc-chevron">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        View Project Documentation
                                    </button>
                                    <div class="doc-content-wrapper" id="doc-content">
                                        <div class="artifact-grid">
                                            <div class="artifact-box">
                                                <h4>Logs</h4>
                                                <div class="artifact-content">2025-12-14
                                                    2025-12-17
                                                    2025-12-22
                                                    2025-12-26
                                                    2025-12-27
                                                    2026-12-28</div>
                                            </div>
                                            <div class="artifact-box">
                                                <h4>Progress</h4>
                                                <div class="artifact-content">2025-12-14
                                                    NEXT STEPS

                                                    Make it keep snapshots of data every file if its been changed âœ…

                                                    Make email say how much storage you have used in the S3 and
                                                    estimated cost âœ…

                                                    Prove its encrypted âœ…

                                                    Make it auto backup âœ…


                                                    2025-12-17
                                                    OUTLINE
                                                    I have mutliple hard drives that have differnt names

                                                    one is Backup(E:)
                                                    Another is
                                                    Local Disk(F:)

                                                    they are not plugged in at all times, can i make it so that 15
                                                    minutes before its about to backup it sends a notificaiton on my
                                                    computer saying backup in 15 minutes, you should plug in your hard
                                                    drives.

                                                    In the S3 bucket for each backup can you make it so that, it creates
                                                    a folder for each one for example

                                                    For the main computer it should say MAIN
                                                    for the F: it should say White Hard Drive
                                                    for the E: it should say Black Hard Drive

                                                    and it should have all the folders and files there

                                                    Also in the email say how long it took aswell

                                                    Every Friday At Night let it backup all my files


                                                    2025-12-22
                                                    Make Diagram âœ…

                                                    2025-12-26
                                                    SCRIPTING

                                                    Make it notify you in 5 minutes backup will take place âœ…

                                                    Says estimated time âœ…

                                                    Emails at interruption âœ…

                                                    -Make it check the hash and if it says its there DO NOT backup âœ…

                                                    Upload to portfolio âœ…

                                                    -Write what needs to be uploaded âœ…

                                                    -make black hard drive folder black and make white hard drive white
                                                    on image âœ…

                                                    -Edit 15 min 5 minutes on image. âœ…

                                                    -put progress and logs and what you learned and upload script file
                                                    without data âœ…

                                                    -Screenshots of project âœ…

                                                    -Change Description âœ…


                                                    2025-12-28
                                                    Upload to portfolio âœ…

                                                    Progressâœ…

                                                    Logsâœ…

                                                    Screenshotsâœ…

                                                    Scriptâœ…


                                                    Upload to GitHub and linkedinâœ…</div>
                                            </div>
                                            <div class="artifact-box">
                                                <h4>Prompt</h4>
                                                <div class="artifact-content">You are a Senior Cloud Security Engineer
                                                    mentoring students on AWS projects. Your expertise is in secure
                                                    cloud storage, automation, and cost-efficient design. You work with:

                                                    S3 (buckets, versioning, lifecycle policies, Deep Glacier)

                                                    IAM (least-privilege users/roles, policies)

                                                    Python scripting (automation, hashing, logging)

                                                    KMS (server-side encryption)

                                                    SNS (notifications and email alerts)

                                                    Your task is to take this project outline and produce step-by-step,
                                                    very clear, specific instructions to implement it securely,
                                                    efficiently, and correctly in AWS:

                                                    Project Overview:

                                                    Goal: An automated backup system for three hard drives (Main 512GB,
                                                    Black 2TB, White 1TB) that runs every Friday at 5 PM.

                                                    Change detection: Only uploads files that have changed by hashing
                                                    each file and comparing to previous snapshots.

                                                    Snapshots: Stores files in S3 under YYYY/MM/DD/&lt;DRIVE&gt;/â€¦.
                                                    Unchanged files are skipped.

                                                    Notification: 5 minutes before backup, sends an SNS alert to plug in
                                                    drives if changes occurred.

                                                    Logging: Maintains a TXT log of all backed-up files.

                                                    Email summary: Sends folder-level summaries instead of full file
                                                    lists, including estimated backup cost.

                                                    Storage class: Deep Glacier for cost efficiency (rare restores,
                                                    secure storage).

                                                    Security: KMS encryption at rest, IAM least-privilege access, and
                                                    adherence to best practices.

                                                    Instructions Requirements:

                                                    Break down every step from AWS setup to Python script execution.

                                                    Include S3 bucket creation, versioning, lifecycle rules, Deep
                                                    Glacier transitions.

                                                    Specify IAM policies, least-privilege user setup, and KMS key
                                                    creation.

                                                    Include Python logic for hashing, snapshot detection, logging, and
                                                    uploading to S3.

                                                    Include SNS topic setup, subscription, and automated notifications.

                                                    Explain how all components interact and best practices for security,
                                                    efficiency, and cost savings.

                                                    Provide concise commands, CLI snippets, or code examples where
                                                    appropriate.

                                                    Assume the student has intermediate Python and AWS knowledge but
                                                    needs guidance to make a production-quality project.

                                                    End goal: Produce a step-by-step, implementable plan that a student
                                                    could follow to replicate this secure, automated backup system in
                                                    AWS.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <ul class="feature-list" style="margin-top: var(--spacing-md);">
                                    <li class="feature-item">
                                        <div class="feature-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                            </svg>
                                        </div>
                                        <div class="feature-content">
                                            <h4>Drive Monitoring & Notification (SNS)</h4>
                                            <p>Alerts sent 5 minutes before backup to ensure drives are connected.
                                            </p>
                                        </div>
                                    </li>

                                    <li class="feature-item">
                                        <div class="feature-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="16 3 21 3 21 8"></polyline>
                                                <line x1="4" y1="20" x2="21" y2="3"></line>
                                                <polyline points="21 16 21 21 16 21"></polyline>
                                                <line x1="15" y1="15" x2="21" y2="21"></line>
                                                <line x1="4" y1="4" x2="9" y2="9"></line>
                                            </svg>
                                        </div>
                                        <div class="feature-content">
                                            <h4>Change Detection (Hashing)</h4>
                                            <p>Scans and hashes files to upload only changed content, saving
                                                bandwidth
                                                and storage.</p>
                                            <p>Scans and hashes files to upload only changed content, saving
                                                bandwidth and storage.</p>
                                        </div>
                                    </li>
                                    <li class="feature-item">
                                        <div class="feature-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path
                                                    d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                                                </path>
                                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                                <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                            </svg>
                                        </div>
                                        <div class="feature-content">
                                            <h4>Storage & Versioning (S3)</h4>
                                            <p>Organized snapshots by date/drive. Retention of previous versions.
                                            </p>
                                        </div>
                                    </li>
                                    <li class="feature-item">
                                        <div class="feature-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <path d="M12 6v6l4 2"></path>
                                            </svg>
                                        </div>
                                        <div class="feature-content">
                                            <h4>Cost Optimization (Deep Glacier)</h4>
                                            <p>Lifecycle rules transition older snapshots to Deep Glacier.</p>
                                        </div>
                                    </li>
                                    <li class="feature-item">
                                        <div class="feature-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                            </svg>
                                        </div>
                                        <div class="feature-content">
                                            <h4>Security (AWS KMS)</h4>
                                            <p>Encryption at rest using customer-managed keys.</p>
                                        </div>
                                    </li>
                                    <li class="feature-item">
                                        <div class="feature-icon">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                        </div>
                                        <div class="feature-content">
                                            <h4>Access Control (IAM)</h4>
                                            <p>Least-privilege IAM roles for upload, encryption, and notifications.
                                            </p>
                                        </div>
                                    </li>
                                </ul>

                                <div class="security-practices">
                                    <button class="doc-toggle-btn btn-accent" onclick="toggleSecurityPractices(this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="width:20px; height:20px; transition: transform 0.3s;"
                                            id="sec-chevron">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        Security Practices
                                    </button>
                                    <div class="sec-content-wrapper" id="sec-content">
                                        <p style="margin-top: var(--spacing-sm);">Will update this section soon</p>
                                    </div>
                                </div>

                                <div class="what-i-learned">
                                    <button class="doc-toggle-btn btn-secondary" onclick="toggleWhatILearned(this)">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            style="width:20px; height:20px; transition: transform 0.3s;"
                                            id="learn-chevron">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                        What I Learned
                                    </button>
                                    <div class="learn-content-wrapper" id="learn-content">
                                        <div style="margin-top: var(--spacing-sm);">
                                            <p>This project demonstrates the use of AWS services to create a secure and
                                                cost-effective backup system.</p>
                                            <ul
                                                style="list-style: disc; margin-left: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                                                <li><strong>Secure & Cost-Effective:</strong> Used AWS S3 to store
                                                    backups, AWS KMS for encryption, AWS SNS for email notifications,
                                                    and IAM for least-privilege access controls.</li>
                                                <li><strong>Automated Scheduling:</strong> System automatically backs up
                                                    all files in the specified directory(s) to an encrypted S3 bucket
                                                    every Friday at 10:00 PM EST.</li>
                                                <li><strong>Cost Optimization:</strong> All files are put into a Deep
                                                    Glacier storage class for cost optimization.</li>
                                                <li><strong>Incremental Backups:</strong> The script checks a list of
                                                    hashes for each file and compares them to the S3 bucket, backing up
                                                    only new or modified files to save time and storage space.</li>
                                                <li><strong>Email Notifications:</strong> When the backup is complete,
                                                    the script sends an email notification via AWS SNS containing
                                                    folders, time, size, and other relevant information.</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- End what-i-learned -->
                </div> <!-- End project-content-wrapper -->
            </div> <!-- End project-card -->


            <!-- LABS -->
            <div class="project-category fade-in">
                <h2 class="category-title">Labs</h2>
                <div class="projects-grid">
                    <!-- Placeholder Lab Project -->
                    <div class="project-card">
                        <div class="project-info">
                            <h3>Home Lab Setup</h3>
                            <p>Virtualization environment for testing security tools.</p>
                            <div class="project-tags"><span class="tag">VirtualBox</span><span class="tag">Linux</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CYBERSEC PROJECTS -->
            <div class="project-category fade-in">
                <h2 class="category-title">Cybersec Projects</h2>
                <div class="projects-grid">
                    <!-- Placeholder Content -->
                    <p style="color:var(--color-text-gray);">More projects coming soon...</p>
                </div>
            </div>

            <!-- CLOUD SECURITY PROJECTS -->
            <div class="project-category fade-in">
                <h2 class="category-title">Cloud security projects</h2>
                <div class="projects-grid">
                    <!-- Placeholder Content -->
                    <p style="color:var(--color-text-gray);">More projects coming soon...</p>
                </div>
            </div>

        </div>
    </section>

    <!-- ===== FOOTER ===== -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Zayan Parpia. Crafted with passion and code.</p>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="back-to-top" aria-label="Back to top">â†‘</button>

    <!-- ===== FULLSCREEN IMAGE MODAL ===== -->
    <div id="imageModal" class="image-modal">
        <span class="close-modal" id="closeModal">&times;</span>
        <img class="modal-content" id="fullImage">
        <div id="caption" class="modal-caption"></div>
    </div>

    <!-- JavaScript -->
    <script src="script.js"></script>
    <script>
        // Toggle Read More
        function toggleDetails(btn) {
            const details = btn.nextElementSibling;
            if (details.style.display === "none") {
                details.style.display = "block";
                btn.textContent = "Read Less";
            } else {
                details.style.display = "none";
                btn.textContent = "Read More";
            }
        }

        // Toggle Documentation dropdown
        function toggleDocumentation(btn) {
            const wrapper = btn.nextElementSibling;
            const chevron = btn.querySelector('.chevron');

            // Toggle active class on wrapper
            if (wrapper.style.maxHeight && wrapper.style.maxHeight !== '0px') {
                wrapper.style.maxHeight = '0px';
                wrapper.style.opacity = '0';
                chevron.style.transform = 'rotate(0deg)';
                btn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round"
                        style="width:16px; height:16px; transition: transform 0.3s;" class="chevron">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                    View Project Documentation
                `;
            } else {
                wrapper.style.maxHeight = '2000px';
                wrapper.style.opacity = '1';
                chevron.style.transform = 'rotate(180deg)';
                btn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round"
                        style="width:16px; height:16px; transition: transform 0.3s; transform: rotate(180deg);" class="chevron">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                    Hide Project Documentation
                `;
            }
        }

        // Toggle What I Learned dropdown
        function toggleWhatILearned(btn) {
            const wrapper = btn.nextElementSibling;
            const chevron = btn.querySelector('svg');

            if (wrapper.classList.contains('expanded')) {
                wrapper.classList.remove('expanded');
                chevron.style.transform = 'rotate(0deg)';
            } else {
                wrapper.classList.add('expanded');
                chevron.style.transform = 'rotate(180deg)';
            }
        }

        // Toggle Security Practices dropdown
        function toggleSecurityPractices(btn) {
            const wrapper = btn.nextElementSibling;
            const chevron = btn.querySelector('svg');

            if (wrapper.classList.contains('expanded')) {
                wrapper.classList.remove('expanded');
                chevron.style.transform = 'rotate(0deg)';
            } else {
                wrapper.classList.add('expanded');
                chevron.style.transform = 'rotate(180deg)';
            }
        }

        // Copy Code Functionality
        function copyCode(btn) {
            const codeBlock = btn.parentElement.querySelector('code');
            const codeText = codeBlock.innerText;

            navigator.clipboard.writeText(codeText).then(() => {
                const originalText = btn.innerHTML;
                btn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:14px; height:14px; margin-right:4px;">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Copied!
                `;

                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }
        // Toggle Project Card
        function toggleProject(btn) {
            const card = btn.closest('.project-card');
            card.classList.toggle('collapsed');
        }
    </script>

</body>

</html>